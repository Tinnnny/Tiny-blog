# 数据库的设计
多表之间的关系有一对一、一对多(多对一)和多对多等三种。

## 实现关系：
1. 一对多(多对一)：

<div align="center">
<img src="http://ww1.sinaimg.cn/large/007Rnr4nly1g9rn1pbgzhj30na0c9jri.jpg">
</div>

2. 多对多：
  * 如：学生和课程
  * 实现方式：多对多关系实现需要借助第三张中间表。中间表至少包含两个字段，这两个字段作为第三张表的外键，分别指向两张表的主键,里面的内容就是把多对多的内容列举出来。此时，这两个字段就可以是联合主键。

<div align="center">
<img src="http://ww1.sinaimg.cn/large/007Rnr4nly1g9rmzjgdx5j30v10g5mxm.jpg">
</div>

3. 一对一(了解)：
  * 如：人和身份证
  * 实现方式：一对一关系实现，可以在任意一方添加唯一外键指向另一方的主键。

<div align="center">
<img src="http://ww1.sinaimg.cn/large/007Rnr4nly1g9rn0n1156j30oq0brglt.jpg">
</div>

## 案例

```sql
//创建旅游线路分类表 tab_category
//cid 旅游线路分类主键，自动增长
//cname 旅游线路分类名称非空，唯一，字符串 100
CREATE TABLE tab_category (
	cid INT PRIMARY KEY AUTO_INCREMENT,
	cname VARCHAR(100) NOT NULL UNIQUE
);
```
```sql
-- 创建旅游线路表 tab_route
/*
rid 旅游线路主键，自动增长
rname 旅游线路名称非空，唯一，字符串 100
price 价格
rdate 上架时间，日期类型
cid 外键，所属分类
*/
CREATE TABLE tab_route(
	rid INT PRIMARY KEY AUTO_INCREMENT,
	rname VARCHAR(100) NOT NULL UNIQUE,
	price DOUBLE,
	rdate DATE,
	cid INT,
	FOREIGN KEY (cid) REFERENCES tab_category(cid)
);
```
```sql
/*创建用户表 tab_user
uid 用户主键，自增长
username 用户名长度 100，唯一，非空
password 密码长度 30，非空
name 真实姓名长度 100
birthday 生日
sex 性别，定长字符串 1
telephone 手机号，字符串 11
email 邮箱，字符串长度 100
*/
CREATE TABLE tab_user (
	uid INT PRIMARY KEY AUTO_INCREMENT,
	username VARCHAR(100) UNIQUE NOT NULL,
	PASSWORD VARCHAR(30) NOT NULL,
	NAME VARCHAR(100),
	birthday DATE,
	sex CHAR(1) DEFAULT '男',
	telephone VARCHAR(11),
	email VARCHAR(100)
);
```
```sql
/*
创建收藏表 tab_favorite
rid 旅游线路 id，外键
date 收藏时间
uid 用户 id，外键
rid 和 uid 不能重复，设置复合主键，同一个用户不能收藏同一个线路两次
*/
CREATE TABLE tab_favorite (
	rid INT, -- 线路id
	DATE DATETIME,
	uid INT, -- 用户id
	-- 创建复合主键
	PRIMARY KEY(rid,uid), -- 联合主键
	FOREIGN KEY (rid) REFERENCES tab_route(rid),
	FOREIGN KEY(uid) REFERENCES tab_user(uid)
);
```

​		
## 数据库设计的范式
### 概述
设计数据库时，需要遵循的一些规范。要遵循后边的范式要求，必须先遵循前边的所有范式要求。

目前关系数据库有六种范式：第一范式（1NF）、第二范式（2NF）、第三范式（3NF）、巴斯-科德范式（BCNF）、第四范式(4NF）和第五范式（5NF，又称完美范式）。

### 第一范式（1NF）
每一列都是不可分割的原子数据项

| 学号    | 姓名  | 系名  | 系主任 | 课程名称  | 分数 |
|-------|-----|-----|-----|-------|----|
| 10010 | 张无忌 | 经济系 | 张三丰 | 高等数学  | 95 |
| 10010 | 张无忌 | 经济系 | 张三丰 | 大学英语  | 87 |
| 10010 | 张无忌 | 经济系 | 张三丰 | 计算机基础 | 65 |
| 10011 | 令狐冲 | 法律系 | 任我行 | 法理学   | 77 |
| 10011 | 令狐冲 | 法律系 | 任我行 | 大学英语  | 87 |
| 10011 | 令狐冲 | 法律系 | 任我行 | 法律社会学 | 65 |
| 10012 | 杨过  | 法律系 | 任我行 | 法律社会学 | 95 |
| 10012 | 杨过  | 法律系 | 任我行 | 法理学   | 97 |
| 10012 | 杨过  | 法律系 | 任我行 | 大学英语  | 99 |
| ||计算机系  | 殷天正 |


::: warning 存在的问题：
1. 存在非常严重的数据冗余(重复)：姓名、系名、系主任
2. 数据添加存在问题：添加新开设的系和系主任时，数据不合法
3. 数据删除存在问题：张无忌同学毕业了，删除数据，会将系的数据一起删除。
:::

### 第二范式（2NF）
在1NF的基础上，非码属性必须完全依赖于码（在1NF基础上消除非主属性对主码的部分函数依赖）
::: tip 相关概念：
1. 函数依赖：A-->B,如果通过A属性(属性组)的值，可以确定唯一B属性的值。则称B依赖于A
	例如：学号-->姓名。  （学号，课程名称） --> 分数
2. 完全函数依赖：A-->B， 如果A是一个属性组，则B属性值得确定需要依赖于A属性组中所有的属性值。
	例如：（学号，课程名称） --> 分数
3. 部分函数依赖：A-->B， 如果A是一个属性组，则B属性值得确定只需要依赖于A属性组中某一些值即可。
	例如：（学号，课程名称） -- > 姓名
4. 传递函数依赖：A-->B, B -- >C . 如果通过A属性(属性组)的值，可以确定唯一B属性的值，在通过B属性（属性组）的值可以确定唯一C属性的值，则称 C 传递函数依赖于A
	例如：学号-->系名，系名-->系主任
5. 码：如果在一张表中，一个属性或属性组，被其他所有属性所完全依赖，则称这个属性(属性组)为该表的码
	例如：该表中码为：（学号，课程名称）
	* 主属性：码属性组中的所有属性
	* 非主属性：除过码属性组的属性
:::	

课程表
| 学号    | 课程名称  | 分数 |
|-------|-------|----|
| 10010 | 高等数学  | 95 |
| 10010 | 大学英语  | 87 |
| 10010 | 计算机基础 | 65 |
| 10011 | 法理学   | 77 |
| 10011 | 大学英语  | 87 |
| 10011 | 法律社会学 | 65 |
| 10012 | 法律社会学 | 95 |
| 10012 | 法理学   | 97 |
| 10012 | 大学英语  | 99 |

学生表
| 学号    | 姓名  | 系名  | 系主任 |
|-------|-----|-----|-----|
| 10010 | 张无忌 | 经济系 | 张三丰 |
| 10011 | 令狐冲 | 法律系 | 任我行 |
| 10012 | 杨过  | 法律系 | 任我行 |
||| 计算机系  | 殷天正 |

::: warning 存在的问题：
2. 数据添加存在问题：添加新开设的系和系主任时，数据不合法
3. 数据删除存在问题：张无忌同学毕业了，删除数据，会将系的数据一起删除。
:::

### 第三范式（3NF）
在2NF基础上，任何非主属性不依赖于其它非主属性（在2NF基础上消除传递依赖）

选课表

| 学号    | 课程名称  | 分数 |
|-------|-------|----|
| 10010 | 高等数学  | 95 |
| 10010 | 大学英语  | 87 |
| 10010 | 计算机基础 | 65 |
| 10011 | 法理学   | 77 |
| 10011 | 大学英语  | 87 |
| 10011 | 法律社会学 | 65 |
| 10012 | 法律社会学 | 95 |
| 10012 | 法理学   | 97 |
| 10012 | 大学英语  | 99 |

学生表
| 学号    | 姓名  | 系名  |
|-------|-----|-----|
| 10010 | 张无忌 | 经济系 |
| 10011 | 令狐冲 | 法律系 |
| 10012 | 杨过  | 法律系 |

系表
| 系名   | 系主任 |
|------|-----|
| 经济系  | 张三丰 |
| 法律系  | 任我行 |
| 计算机系 | 殷天正 |



## 数据库的备份和还原
备份
```sql
 mysqldump -u用户名 -p密码 数据库名称 > 保存的路径
 ```
还原：
1. 登录数据库
2. 创建数据库相同名称的数据库
3. 使用数据库(`use database db1`)
4. 执行文件。
```sql
source 文件路径
```